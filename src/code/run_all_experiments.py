"""
Usage:
    run_all_experiments.py <num_workers>

Arguments
    num_workers  : the number of cores to use in parallel
"""
import methods
import yaml
import pandas as pd
import sys
import dask

names = [
    "demand=13_posts=original_allocation=current_year=2019",
    "demand=19_posts=original_allocation=current_year=2019",
    "demand=34_posts=original_allocation=current_year=2019",
    "demand=45_posts=original_allocation=current_year=2019",
    "demand=13_posts=original_allocation=demand_13_current_current_year=2019",
    "demand=19_posts=original_allocation=demand_19_current_current_year=2019",
    "demand=34_posts=original_allocation=demand_34_current_current_year=2019",
    "demand=45_posts=original_allocation=demand_45_current_current_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_60_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_68_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_76_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_84_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_92_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_100_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_108_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_116_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_124_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_64_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_72_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_80_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_88_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_96_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_104_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_112_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_120_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_62_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_70_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_78_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_86_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_94_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_102_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_110_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_118_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_66_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_74_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_82_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_90_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_98_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_106_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_114_year=2019",
    "demand=13_posts=original_allocation=demand_13_multiple_122_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_60_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_68_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_76_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_84_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_92_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_100_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_108_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_116_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_124_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_64_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_72_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_80_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_88_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_96_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_104_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_112_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_120_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_62_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_70_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_78_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_86_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_94_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_102_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_110_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_118_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_66_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_74_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_82_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_90_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_98_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_106_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_114_year=2019",
    "demand=19_posts=original_allocation=demand_19_multiple_122_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_60_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_68_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_76_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_84_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_92_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_100_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_108_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_116_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_124_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_64_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_72_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_80_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_88_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_96_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_104_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_112_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_120_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_62_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_70_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_78_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_86_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_94_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_102_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_110_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_118_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_66_year=2019",
    "demand=34_posts=original_allocation=demand_34_multiple_74_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_60_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_68_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_76_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_84_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_92_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_100_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_108_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_116_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_124_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_64_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_72_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_80_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_88_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_96_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_104_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_112_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_120_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_62_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_70_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_78_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_86_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_94_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_102_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_110_year=2019",
    "demand=45_posts=original_allocation=demand_45_multiple_118_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_60_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_68_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_76_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_84_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_92_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_100_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_108_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_116_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_124_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_64_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_72_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_80_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_88_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_96_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_104_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_112_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_120_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_62_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_70_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_78_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_86_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_94_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_102_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_110_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_118_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_66_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_74_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_82_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_90_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_98_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_106_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_114_year=2019",
    "demand=13_posts=original_allocation=demand_13_single_122_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_60_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_68_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_76_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_84_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_92_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_100_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_108_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_116_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_124_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_64_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_72_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_80_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_88_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_96_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_104_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_112_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_120_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_62_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_70_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_78_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_86_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_94_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_102_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_110_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_118_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_66_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_74_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_82_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_90_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_98_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_106_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_114_year=2019",
    "demand=19_posts=original_allocation=demand_19_single_122_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_60_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_68_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_76_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_84_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_92_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_100_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_108_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_116_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_124_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_64_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_72_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_80_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_88_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_96_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_104_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_112_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_120_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_62_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_70_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_78_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_86_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_94_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_102_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_110_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_118_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_66_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_74_year=2019",
    "demand=34_posts=original_allocation=demand_34_single_82_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_60_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_68_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_76_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_84_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_92_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_100_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_108_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_116_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_124_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_64_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_72_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_80_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_88_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_96_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_104_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_112_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_120_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_62_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_70_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_78_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_86_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_94_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_102_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_110_year=2019",
    "demand=45_posts=original_allocation=demand_45_single_118_year=2019",
]

def write_results(name):
    max_time = 400
    n_trials = 8
    params_name = f"src/params/{name}.yml"
    results_name = f"src/results/{name}.csv"

    with open(params_name, "r") as f:
        params = yaml.load(f, Loader=yaml.CLoader)

    all_recs = []
    for trial in range(int(n_trials)):
        recs = methods.run_full_simulation(params, float(max_time), trial)
        all_recs.append(recs)

    data = pd.concat(all_recs)
    data = data[data["destination"] == -1]
    data.to_csv(results_name)
    print(f"Completed {name}.")



if __name__ == "__main__":
    args = sys.argv
    num_workers = int(args[1])
    tasks = [dask.delayed(write_results)(name) for name in names[0:4]]
    dask.compute(*tasks, num_workers=num_workers)